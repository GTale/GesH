# 加载必要的 .NET 库
Add-Type -AssemblyName System.Windows.Forms
Add-Type -AssemblyName System.Drawing

# 捕获整个屏幕（支持多显示器）
$screenBounds = [System.Windows.Forms.SystemInformation]::VirtualScreen
$bitmap = New-Object System.Drawing.Bitmap $screenBounds.Width, $screenBounds.Height
$graphics = [System.Drawing.Graphics]::FromImage($bitmap)
$graphics.CopyFromScreen($screenBounds.Location, [System.Drawing.Point]::Empty, $screenBounds.Size)

# 保存为临时文件
$tempFile = [System.IO.Path]::GetTempFileName() + ".png"
$bitmap.Save($tempFile, [System.Drawing.Imaging.ImageFormat]::Png)
$graphics.Dispose()
$bitmap.Dispose()
Write-Host "截图已保存到: $tempFile"



# 创建 Outlook 对象
$outlook = New-Object -ComObject Outlook.Application
$mail = $outlook.CreateItem(0)  # 0 表示邮件项

# 配置邮件内容
$mail.To = "recipient@example.com"  # 替换为实际邮箱
$mail.Subject = "自动发送的屏幕截图 - $(Get-Date -Format 'yyyy-MM-dd HH:mm')"
$mail.Body = "系统自动捕获的屏幕截图，请查收附件。"

# 添加截图附件
$mail.Attachments.Add($tempFile) | Out-Null

# 发送邮件（后台静默发送）
$mail.Send()
Write-Host "邮件已发送！"

# 清理临时文件
Start-Sleep -Seconds 2  # 确保附件已附加
Remove-Item $tempFile -Force
